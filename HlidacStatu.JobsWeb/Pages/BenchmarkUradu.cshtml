@page "{id?}"
@model BenchmarkUraduModel

@using HlidacStatu.JobsWeb.Services
@using HlidacStatu.JobsWeb.Models

@{
    ViewData["Title"] = "Benchmark úřadů";

    Boxplot graphModel = new Boxplot();
    TableViewModel tableModel = new TableViewModel();

    bool showStatistics = !string.IsNullOrWhiteSpace(Model.Ico);
    var statistics = new List<JobStatistics>();

    if (Model.Key.HasValue)
    {
        if (showStatistics)
            statistics = JobService.GetOdberatelStatitstics(Model.Ico, Model.Key.Value);

        graphModel.BasicData = statistics;
        graphModel.CompareWith = JobService.GetStatistics(Model.Key.Value);

        tableModel.Statistics = statistics;
    }
}

@section Scripts
{
    <script>
    $(document).ready(function() {
      $("#selectNavigace").change(function(){
        if ($(this).val()!='') {
          window.location.href= '/BenchmarkUradu/' + $(this).val() + window.location.search;
        }
      });
    });
    </script>
}

<h1>Benchmark úřadů</h1>
@if (Model.Key.HasValue)
{
    <h2>Seznam úřadů</h2>

    <div class="input-group mb-3">
        <label class="input-group-text" for="selectNavigace">Vyberte úřad:</label>
        <select class="form-select" id="selectNavigace">
            <option value="" selected="@string.IsNullOrEmpty(Model.Ico)">Zvolte úřad...</option>
            @foreach (var (ico, nazev, pocetSmluv) in JobService.GetOdberateleList(Model.Key.Value).OrderByDescending(x => x.pocetSmluv))
            {
                <option value="@ico" selected="@(Model.Ico == ico)">@nazev (@pocetSmluv smluv)</option>
            }
        </select>
    </div>

    if (!string.IsNullOrEmpty(Model.Ico))
    {
        <hr/>

        <h2>@Model.Nazev</h2>

        if (showStatistics)
        {
            <partial name="Shared/_SouhrnTable" model="tableModel"/>
            <partial name="Shared/_BoxPlot" model="graphModel"/>
        }
    }
}