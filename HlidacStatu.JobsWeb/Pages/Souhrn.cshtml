@page
@using HlidacStatu.JobsWeb.Services
@using HlidacStatu.JobsWeb.Models
@model SouhrnModel

@{
    ViewData["Title"] = "Souhrnné statistiky";

    Boxplot graphModel = new Boxplot();
    TableViewModel tableModel = new TableViewModel();

    if (Model.Key.HasValue)
    {
        List<JobStatistics> statistics = JobService.GetStatistics(Model.Key.Value);
        graphModel.BasicData = statistics;

        tableModel.Statistics = statistics;
        tableModel.LinkHref = "/obor";
        tableModel.Key = Model.Key;
    }
    
}

<h2>Souhrnné statistiky</h2>
@{
    var distinctJobsForYearAndSubject = JobService.DistinctJobsForYearAndSubject(Model.Key.Value);
    var pocetSmluv = distinctJobsForYearAndSubject
        .Select(m => m.SmlouvaId).Distinct().Count();
    var pocetZadavatelu = distinctJobsForYearAndSubject
        .Select(m => m.IcoOdberatele).Distinct().Count();
    var pocetDodavatelu = distinctJobsForYearAndSubject
        .SelectMany(m => m.IcaDodavatelu).Distinct().Count();
    var pocetCen = distinctJobsForYearAndSubject
        .Count();
    var tmp = distinctJobsForYearAndSubject.OrderByDescending(m => m.PricePerUnitVat).ToArray();
}
<p>
    Analýza obsahuje údaje z @pocetSmluv smluv, od @pocetZadavatelu zadavatelů, a @pocetDodavatelu dodavatelů. 
    Analýzu zpracováváme z celkem @pocetCen nalezených cen.
    </p>

@if (Model.Key.HasValue)
{
    <partial name="Shared/_SouhrnTable" model="tableModel"/>
    <partial name="Shared/_BoxPlot" model="graphModel"/>
    
}

