@using HlidacStatu.Entities
@using HlidacStatu.Repositories
@using HlidacStatu.Repositories.SharedModels
@using PlatyUredniku.Models
@inject ZiggyCreatures.Caching.Fusion.IFusionCache cache;
@{
    
    List<PuPolitikPrijem> platy = (List<PuPolitikPrijem>?)ViewData["platy"];

    var organizationOfTheDay = await PpRepo.GetOrganizationOfTheDayAsync();
    var ceoOfTheDay = organizationOfTheDay.Platy.FirstOrDefault(p => p.JeHlavoun == true && p.Rok == PpRepo.DefaultYear);
    var dataForOrganizationOfTheDay = await StaticCache.GetFullDetailAsync(organizationOfTheDay.DS);
}

<section class="d-flex align-items-center justify-content-center">
    <div class="container">
        <h2>
            Platy politiků v @PpRepo.DefaultYear
        </h2>
        <p class="">
            Nové platy politiků - prozkoumejte a podívejte se, kolik akumulují
        </p>
    </div>
</section>

<section class="d-flex align-items-center justify-content-center alter-bg-color">
    <div class="container">
        <h5>
            Za @PpRepo.DefaultYear jsme žádali o platy @(HlidacStatu.Util.RenderData.NiceNumber(stats.PocetOslovenych)) organizací
            a plat nám poskytlo @(HlidacStatu.Util.RenderData.NiceNumber(stats.PocetCoPoslaliPlat)) z nich.

        </h5>
        <p>
            <a class="btn btn-primary btn-sm" href="/oblasti">Seznam všech organizací <span class="badge text-bg-danger">@(HlidacStatu.Util.RenderData.NiceNumber(stats.PocetOslovenych))</span></a>
        </p>
        <p class="mb-2 mt-4 text-body-secondary">
        <p>Platy organizací v jednotlivých oblastech</p>
        <div class="row">
                @{
                    int count = 0;
                }
                @foreach (var group in PpRepo.MainTags.Chunk(PpRepo.MainTags.Length / 4 + 1))
                {
                    count = count + 1;
                <div class="col-md-3 col-sm-6 col-6">

                        @foreach (var item in group)
                        {
                        <hashtag tag="@item" additional-class="badge rounded-pill border me-3 mb-2 order-{@count}" style="font-size:0.9em"></hashtag>
                        <br />
                        }

                </div>
                }
        </div>

    </div>
</section>

<section class="d-flex align-items-center justify-content-center">
    <div class="container">
        <div class="row">
            <div class="col-12 col-md-6">
                <h3>
                    @organizationOfTheDay.Nazev
                    <small class="text-body-secondary" style="font-size:75%">Organizace dne</small>
                </h3>
                <div>
                    Najdete ji v kategoriích:
                    @foreach (var tag in organizationOfTheDay.Tags)
                    {
                        <hashtag tag="@tag.Tag"></hashtag>
                    }
                </div>
                <br />

                @if (ceoOfTheDay is not null)
                {
                    <p>
                        Nejvyšším představitelem organizace je <strong>@ceoOfTheDay.NazevPozice</strong>.
                        Jeho hrubý měsíční plat je @HlidacStatu.Util.RenderData.NicePrice(ceoOfTheDay.HrubyMesicniPlatVcetneOdmen).
                    </p>

                }
                <p>  
                    @Html.Raw(Devmasters.Lang.CS.Plural.GetWithZero(dataForOrganizationOfTheDay.Platy.AktualniRok().Count,
                             "<span class='text-danger'><i class='fa-solid fa-circle-xmark'></i> Odmítli nám poskytnout jakékoliv platy</span>",
                             "<span class='text-warning'><i class='fa-solid fa-circle-exclamation'></i></span> Evidujeme od organizace jeden plat jedné pozice",
                             $"<span class='text-success'><i class='fa-solid fa-badge-check'></span></i>Dostali jsme celkem {{0}} platy vedení organizace",
                             $"<span class='text-success'><i class='fa-solid fa-badge-check'></span></i>Dostali jsme celkem {{0}} manažerských platů")
                             )
                    za rok @(PpRepo.DefaultYear).
                </p>
                <p>
                    <a asp-action="Detail"
                       asp-route-id="@organizationOfTheDay.DS"
                       asp-route-rok="@PpRepo.DefaultYear"
                       class="btn btn-primary btn-sm">Detail o platech</a>
                </p>

            </div>
            <div class="col-12 col-lg-6">

                <div>
                    <partial name="Graphs/_AreaRangePlot" model="@(new AreaRangeRenderOptions(){ Platy= dataForOrganizationOfTheDay.Platy, CssHeight="250"})" />
                </div>
            </div>
        </div>
    </div>
</section>

<section class="d-flex align-items-center justify-content-center alter-bg-color">
    <div class="container">

        <h2>
            Analýzy a porovnání
        </h2>

        <partial name="_Analyzy_List" />

        
    </div>
</section>

<p class="m-5">

</p>

