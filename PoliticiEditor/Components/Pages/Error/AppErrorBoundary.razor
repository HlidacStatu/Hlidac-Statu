@using PoliticiEditor.Components.Account
@using Serilog
@inherits ErrorBoundary

@inject NavigationManager Navigation
@inject UserHelper UserHelper


@if (CurrentException is null)
{
    @ChildContent
}
else if (ErrorContent is not null)
{
    @ErrorContent(CurrentException)
}

@code {
    
    private readonly ILogger _logger = Log.ForContext<Error>();

    protected override async Task OnErrorAsync(Exception ex)
    {
        string? nameid = null; 
        try
        {
            var user = await UserHelper.GetCurrentUserAsync();
            nameid = user.GetNameId();
        }
        catch (Exception e)
        {
            Console.WriteLine(e);
            throw;
        }
        var currentUrl = Navigation.Uri;

        _logger.Error(ex, "Neošetřená chyba na stránce [{Url}] u uživatele [{NameId}]", currentUrl, nameid);
        Navigation.NavigateTo("/Error", forceLoad: true);
    }
}