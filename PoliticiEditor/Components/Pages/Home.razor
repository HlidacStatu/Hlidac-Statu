@page "/"
@using System.Security.Claims
@using PoliticiEditor.Components.Account
@using HlidacStatu.Extensions;

@inject UserHelper UserHelper

@rendermode @(new InteractiveServerRenderMode(prerender: false))

<PageTitle>Vítejte v administraci politiků Hlídače státu</PageTitle>


@if (User is null || User.Identity?.IsAuthenticated == false)
{
    <Login/>
}
else
{
    <h2>Na těchto stránkách můžete editovat informace o sobě</h2>

    <div class="person-profile-thumb">
        <a href="/">
            <div class="profile-picture border" style="background-image: url('https://www.hlidacstatu.cz/Photo/@(osoba.NameId)')">
                <!-- diky pouziti background image nezalezi na pomeru stran obrazku a neni poteba tvorit thumbnaily na serveru -->
            </div>
        </a>
        <div>
            <a class="section-title link--blue" href="/">
                <h3>@osoba.FullNameWithYear()</h3>
            </a>
            <div class="new-p new-p--gray new-p--small">
                @osoba.CurrentPoliticalParty()
            </div>
        </div>
    </div>


    <h3 class="row mt-5">Jaké informace o sobě můžete změnit</h3>
    <div class="row m-3 mb-5">
        <div class="col"><a class="btn btn-primary" href="/EditPhoto">Změnit svou fotografii</a></div>
    
    
        <div class="col">
            <a class="btn btn-primary" href="/EditPerson">Změnit některé své osobní údaje</a>
        </div>
        <div class="col">
            <a class="btn btn-primary" href="/EditParty">Přidat/opravit působení v politických stranách</a>
        </div>
        <div class="col">
            <a class="btn btn-primary" href="/EditSocial">Upravit odkazy na sociální sítě</a>
        </div>
        <div class="col">
            <a class="btn btn-primary" href="/EditContacts">Upravit kontaktní údaje</a>
        </div>
        <div class="col">
            <a class="btn btn-primary" href="/EditSalaries">Přidat informaci o platu</a>
        </div>
    </div>
}


@code {

    private ClaimsPrincipal? User { get; set; } 
    private HlidacStatu.Entities.Osoba osoba { get; set; }

    protected override async Task OnInitializedAsync()
    {
        User = await UserHelper.GetCurrentUserAsync();
        osoba = HlidacStatu.Repositories.Osoby.GetByNameId.Get(User.GetNameId());
    }
}
