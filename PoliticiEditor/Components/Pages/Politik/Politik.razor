@page "/politik/{NameId}"
@using HlidacStatu.Repositories
@using PoliticiEditor.Components.Pages.Account
@inject AuthenticationStateProvider AuthenticationStateProvider
@inject NavigationManager Navigation
@inject IdentityRedirectManager RedirectManager


@rendermode InteractiveServer

<PageTitle>@NameId</PageTitle>
@if (OsobaInternalId is not null)
{
    // person edit
    <EditPerson OsobaId="OsobaInternalId.Value"/>
    // Social networks
    <EditSocial OsobaId="OsobaInternalId.Value"/>
    // political party
    <EditParty OsobaId="OsobaInternalId.Value"/>
    // platy politků
    <EditSalaries NameId="@NameId"/>
}


@code {
    
    [Parameter]
    public string NameId { get; set; }

    private int? OsobaInternalId { get; set; } = null;

    protected override async Task OnParametersSetAsync()
    {
        if(string.IsNullOrWhiteSpace(NameId))
            return;

        await RedirectManager.RedirectIfUserIsNotAuthorized(NameId);
        
        
        var osoba = OsobaRepo.GetByNameId(NameId);
        if (osoba is not null)
            OsobaInternalId = osoba.InternalId;

        await base.OnParametersSetAsync();
    }
    
    

}