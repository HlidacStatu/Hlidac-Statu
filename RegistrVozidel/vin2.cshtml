@using System.Globalization
@using System.Linq
@using HlidacStatu.RegistrVozidel.Models
@model HlidacStatu.RegistrVozidel.Models.VinDetailViewModel
@{
    Layout = null;
    var vozidlo = Model?.Vozidlo;
    var titleBrand = string.Join(" ", new[]
    {
        vozidlo?.TovarniZnacka,
        vozidlo?.ObchodniOznaceni
    }.Where(value => !string.IsNullOrWhiteSpace(value)));
    var pageTitle = string.IsNullOrWhiteSpace(titleBrand) ? "Detail vozidla" : titleBrand;
    var technickeProhlidky = Model?.TechnickeProhlidky ?? Array.Empty<TechnickeProhlidky>();
    var ownersHistory = Model?.OwnersHistory ?? Array.Empty<VlastnikProvozovatelVozidla>();
}

@functions {
    private static string Display(string value)
        => string.IsNullOrWhiteSpace(value) ? "-" : value;

    private static string Display(bool? value)
        => value.HasValue ? (value.Value ? "Ano" : "Ne") : "-";

    private static string Display(decimal? value, string suffix = null)
        => value.HasValue ? $"{value.Value:0.##}{suffix}" : "-";

    private static string Display(int? value)
        => value.HasValue ? value.Value.ToString(CultureInfo.InvariantCulture) : "-";

    private static string Display(DateOnly? value)
        => value.HasValue ? value.Value.ToString("d.M.yyyy", CultureInfo.InvariantCulture) : "-";

    private static string DisplayRawOrDash(string value)
        => string.IsNullOrWhiteSpace(value) ? "-" : value;
}

<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>VIN: @Display(vozidlo?.Vin) - @pageTitle</title>
    <meta name="description" content="Prověření vozidla VIN: @Display(vozidlo?.Vin) @pageTitle">
    <link rel="shortcut icon" href="~/favicon.ico">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,200;0,400;0,500;0,700;1,400&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        :root {
            --brand-dark: #152036;
            --brand-accent: #31b67a;
            --brand-muted: #9aa7b9;
            --surface: #ffffff;
            --surface-soft: #f2f5fa;
        }
        body {
            font-family: "Montserrat", Arial, sans-serif;
            background: radial-gradient(circle at top, #eef3fb 0%, #f8fbff 45%, #ffffff 100%);
            color: #1b2433;
        }
        .navbar {
            background: var(--brand-dark);
            padding: 1rem 0;
        }
        .logo {
            font-weight: 700;
            letter-spacing: 0.06em;
            color: #fff;
        }
        .logo strong {
            color: var(--brand-accent);
        }
        .label {
            color: var(--brand-muted);
            text-transform: uppercase;
            font-size: 0.7rem;
            letter-spacing: 0.14em;
        }
        .hero-card {
            background: var(--surface);
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 20px 45px rgba(21, 32, 54, 0.08);
        }
        .brand-badge {
            width: 160px;
            height: 160px;
            border-radius: 16px;
            background: var(--surface-soft);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 1.2rem;
            text-align: center;
            padding: 16px;
            color: var(--brand-dark);
        }
        .box {
            background: var(--surface);
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 12px 30px rgba(21, 32, 54, 0.06);
            margin-top: 24px;
        }
        .box h3 {
            font-size: 1.1rem;
            font-weight: 700;
            margin-bottom: 16px;
        }
        .kv-row {
            border-bottom: 1px dashed #e0e6ef;
            padding: 12px 0;
        }
        .kv-row:last-child {
            border-bottom: none;
        }
        .kv-key {
            color: var(--brand-muted);
            font-size: 0.9rem;
        }
        .kv-value {
            font-weight: 600;
        }
        .btn-green {
            background: var(--brand-accent);
            color: #fff;
            border-radius: 999px;
            padding: 0.6rem 1.6rem;
        }
        .btn-gray {
            background: #e6ebf2;
            color: #2a3547;
            border-radius: 999px;
            padding: 0.6rem 1.6rem;
        }
        .footer {
            color: var(--brand-muted);
            font-size: 0.85rem;
        }
        .history-table thead th {
            text-transform: uppercase;
            font-size: 0.7rem;
            letter-spacing: 0.12em;
            color: var(--brand-muted);
            border-bottom: 1px solid #e0e6ef;
        }
        .history-table tbody tr {
            border-bottom: 1px dashed #e0e6ef;
        }
        .history-table tbody tr:last-child {
            border-bottom: none;
        }
        .history-muted {
            color: var(--brand-muted);
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-md">
        <div class="container">
            <a href="/" class="navbar-brand">
                <span class="logo">REGISTR <strong>VOZIDEL</strong></span>
            </a>
            <button class="navbar-toggler collapsed text-white" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div id="navbar" class="collapse navbar-collapse">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item"><a class="nav-link text-white-50" href="/">Hledání podle VIN</a></li>
                    <li class="nav-item"><a class="nav-link text-white-50" href="/ico">Hledání podle IČO</a></li>
                    <li class="nav-item"><a class="nav-link text-white-50" href="/o-projektu">O projektu</a></li>
                </ul>
            </div>
        </div>
    </nav>

    <section id="check">
        <div class="container mt-5">
            <div class="hero-card">
                <div class="row align-items-center">
                    <div class="col-md-3 col-sm-4 col-12 text-center text-md-start mb-3 mb-md-0">
                        <div class="brand-badge">@Display(vozidlo?.TovarniZnacka)</div>
                    </div>
                    <div class="col-md-9 col-sm-8 col-12">
                        <div class="row">
                            <div class="col-12 mb-3">
                                <span class="label">VIN</span>
                                <h4 id="vin" class="mb-0">@Display(vozidlo?.Vin)</h4>
                            </div>
                            <div class="col-6 mb-3">
                                <span class="label">Tovární značka</span>
                                <h4 class="mb-0">@Display(vozidlo?.TovarniZnacka)</h4>
                            </div>
                            <div class="col-6 mb-3">
                                <span class="label">Obchodní označení</span>
                                <h4 class="mb-0">@Display(vozidlo?.ObchodniOznaceni)</h4>
                            </div>
                            <div class="col-6 mb-3">
                                <span class="label">Barva</span>
                                <h4 class="mb-0">@Display(vozidlo?.Barva)</h4>
                            </div>
                            <div class="col-6 mb-3">
                                <span class="label">Palivo</span>
                                <h4 class="mb-0">@Display(vozidlo?.Palivo)</h4>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="row box" id="zakladni-udaje">
                <div class="col-12">
                    <h3>Identifikace vozidla</h3>
                </div>
                <div class="col-md-6">
                    <div class="kv-row d-flex justify-content-between">
                        <span class="kv-key">Kategorie</span>
                        <span class="kv-value">@Display(vozidlo?.KategorieVozidla)</span>
                    </div>
                    <div class="kv-row d-flex justify-content-between">
                        <span class="kv-key">Druh vozidla</span>
                        <span class="kv-value">@Display(vozidlo?.DruhVozidla)</span>
                    </div>
                    <div class="kv-row d-flex justify-content-between">
                        <span class="kv-key">Typ / varianta / verze</span>
                        <span class="kv-value">@DisplayRawOrDash($"{vozidlo?.Typ} {vozidlo?.Varianta} {vozidlo?.Verze}".Trim())</span>
                    </div>
                    <div class="kv-row d-flex justify-content-between">
                        <span class="kv-key">Výrobce vozidla</span>
                        <span class="kv-value">@Display(vozidlo?.VyrobceVozidla)</span>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="kv-row d-flex justify-content-between">
                        <span class="kv-key">Výrobce motoru</span>
                        <span class="kv-value">@Display(vozidlo?.VyrobceMotoru)</span>
                    </div>
                    <div class="kv-row d-flex justify-content-between">
                        <span class="kv-key">Typ motoru</span>
                        <span class="kv-value">@Display(vozidlo?.TypMotoru)</span>
                    </div>
                    <div class="kv-row d-flex justify-content-between">
                        <span class="kv-key">Číslo motoru</span>
                        <span class="kv-value">@Display(vozidlo?.CisloMotoru)</span>
                    </div>
                    <div class="kv-row d-flex justify-content-between">
                        <span class="kv-key">Rok výroby</span>
                        <span class="kv-value">@Display(vozidlo?.RokVyroby)</span>
                    </div>
                </div>
            </div>

            <div class="row box" id="registrace">
                <div class="col-12">
                    <h3>Registrace a status</h3>
                </div>
                <div class="col-md-6">
                    <div class="kv-row d-flex justify-content-between">
                        <span class="kv-key">1. registrace</span>
                        <span class="kv-value">@Display(vozidlo?.Datum1Registrace)</span>
                    </div>
                    <div class="kv-row d-flex justify-content-between">
                        <span class="kv-key">1. registrace v ČR</span>
                        <span class="kv-value">@Display(vozidlo?.Datum1RegistraceVCr)</span>
                    </div>
                    <div class="kv-row d-flex justify-content-between">
                        <span class="kv-key">Status</span>
                        <span class="kv-value">@Display(vozidlo?.Status)</span>
                    </div>
                    <div class="kv-row d-flex justify-content-between">
                        <span class="kv-key">Zařazení vozidla</span>
                        <span class="kv-value">@Display(vozidlo?.ZarazeniVozidla)</span>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="kv-row d-flex justify-content-between">
                        <span class="kv-key">Účel vozidla</span>
                        <span class="kv-value">@Display(vozidlo?.UcelVozidla)</span>
                    </div>
                    <div class="kv-row d-flex justify-content-between">
                        <span class="kv-key">Druh RZ</span>
                        <span class="kv-value">@Display(vozidlo?.DruhRz)</span>
                    </div>
                    <div class="kv-row d-flex justify-content-between">
                        <span class="kv-key">Číslo TP / ORV</span>
                        <span class="kv-value">@DisplayRawOrDash($"{vozidlo?.CisloTp} {vozidlo?.CisloOrv}".Trim())</span>
                    </div>
                </div>
            </div>

            <div class="row box" id="pohon">
                <div class="col-12">
                    <h3>Pohon a emise</h3>
                </div>
                <div class="col-md-6">
                    <div class="kv-row d-flex justify-content-between">
                        <span class="kv-key">Palivo</span>
                        <span class="kv-value">@Display(vozidlo?.Palivo)</span>
                    </div>
                    <div class="kv-row d-flex justify-content-between">
                        <span class="kv-key">Zdvihový objem</span>
                        <span class="kv-value">@Display(vozidlo?.ZdvihovyObjem)</span>
                    </div>
                    <div class="kv-row d-flex justify-content-between">
                        <span class="kv-key">Max. výkon</span>
                        <span class="kv-value">@Display(vozidlo?.MaxVykon, " kW")</span>
                    </div>
                    <div class="kv-row d-flex justify-content-between">
                        <span class="kv-key">Otáčky</span>
                        <span class="kv-value">@Display(vozidlo?.Otacky, " min-1")</span>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="kv-row d-flex justify-content-between">
                        <span class="kv-key">Plně elektrické vozidlo</span>
                        <span class="kv-value">@Display(vozidlo?.PlneElektrickeVozidlo)</span>
                    </div>
                    <div class="kv-row d-flex justify-content-between">
                        <span class="kv-key">Hybridní vozidlo</span>
                        <span class="kv-value">@Display(vozidlo?.HybridniVozidlo)</span>
                    </div>
                    <div class="kv-row d-flex justify-content-between">
                        <span class="kv-key">Emisní stupeň</span>
                        <span class="kv-value">@Display(vozidlo?.StupenPlneniEmisniUrovne)</span>
                    </div>
                    <div class="kv-row d-flex justify-content-between">
                        <span class="kv-key">CO2</span>
                        <span class="kv-value">@DisplayRawOrDash(vozidlo?.Co2Raw)</span>
                    </div>
                </div>
            </div>

            <div class="row box" id="rozmery">
                <div class="col-12">
                    <h3>Rozměry a hmotnosti</h3>
                </div>
                <div class="col-md-6">
                    <div class="kv-row d-flex justify-content-between">
                        <span class="kv-key">Délka / šířka / výška</span>
                        <span class="kv-value">@DisplayRawOrDash(vozidlo?.CelkovaDelkaSirkaVyskaRaw)</span>
                    </div>
                    <div class="kv-row d-flex justify-content-between">
                        <span class="kv-key">Rozvor</span>
                        <span class="kv-value">@DisplayRawOrDash(vozidlo?.RozvorRaw)</span>
                    </div>
                    <div class="kv-row d-flex justify-content-between">
                        <span class="kv-key">Rozchod</span>
                        <span class="kv-value">@DisplayRawOrDash(vozidlo?.RozchodRaw)</span>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="kv-row d-flex justify-content-between">
                        <span class="kv-key">Provozní hmotnost</span>
                        <span class="kv-value">@DisplayRawOrDash(vozidlo?.ProvozniHmotnost)</span>
                    </div>
                    <div class="kv-row d-flex justify-content-between">
                        <span class="kv-key">Největší technicky přípustná</span>
                        <span class="kv-value">@DisplayRawOrDash(vozidlo?.NejvetsiTechnickyPripustnaPovolenaHmotnostRaw)</span>
                    </div>
                    <div class="kv-row d-flex justify-content-between">
                        <span class="kv-key">Počet míst</span>
                        <span class="kv-value">@DisplayRawOrDash(vozidlo?.PocetMistRaw)</span>
                    </div>
                </div>
            </div>

            <div class="row box" id="technicke-prohlidky">
                <div class="col-12">
                    <h3>Historie technických prohlídek</h3>
                </div>
                <div class="col-12">
                    @if (technickeProhlidky.Any())
                    {
                        <div class="table-responsive">
                            <table class="table history-table align-middle mb-0">
                                <thead>
                                    <tr>
                                        <th>Typ</th>
                                        <th>Stav</th>
                                        <th>Stanice</th>
                                        <th>Platnost</th>
                                        <th>Protokol</th>
                                        <th>Aktuální</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @foreach (var prohlidka in technickeProhlidky.OrderByDescending(item => item.PlatnostOd))
                                    {
                                        <tr>
                                            <td>@Display(prohlidka?.Typ)</td>
                                            <td>@Display(prohlidka?.Stav)</td>
                                            <td>@DisplayRawOrDash(prohlidka?.NazevStk)</td>
                                            <td>@Display(prohlidka?.PlatnostOd) - @Display(prohlidka?.PlatnostDo)</td>
                                            <td>@DisplayRawOrDash(prohlidka?.CisloProtokolu)</td>
                                            <td>@Display(prohlidka?.Aktualni)</td>
                                        </tr>
                                    }
                                </tbody>
                            </table>
                        </div>
                    }
                    else
                    {
                        <div class="history-muted">Bez záznamů.</div>
                    }
                </div>
            </div>

            <div class="row box" id="vlastnici">
                <div class="col-12">
                    <h3>Historie vlastníků a provozovatelů</h3>
                </div>
                <div class="col-12">
                    @if (ownersHistory.Any())
                    {
                        <div class="table-responsive">
                            <table class="table history-table align-middle mb-0">
                                <thead>
                                    <tr>
                                        <th>Vztah</th>
                                        <th>Subjekt</th>
                                        <th>IČO</th>
                                        <th>Adresa</th>
                                        <th>Období</th>
                                        <th>Aktuální</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @foreach (var owner in ownersHistory.OrderByDescending(item => item.DatumOd))
                                    {
                                        <tr>
                                            <td>@DisplayRawOrDash(owner?.FormaVlastnictvi.ToString())</td>
                                            <td>@Display(owner?.Nazev)</td>
                                            <td>@Display(owner?.Ico)</td>
                                            <td>@Display(owner?.Adresa)</td>
                                            <td>@Display(owner?.DatumOd) - @Display(owner?.DatumDo)</td>
                                            <td>@Display(owner?.Aktualni)</td>
                                        </tr>
                                    }
                                </tbody>
                            </table>
                        </div>
                    }
                    else
                    {
                        <div class="history-muted">Bez záznamů.</div>
                    }
                </div>
            </div>

            <div class="row mt-4 mb-5">
                <div class="col-12 text-center">
                    <a href="/" class="btn btn-green me-2">Vyhledat jiné vozidlo</a>
                    <a href="/ico" class="btn btn-gray">Hledat podle IČO</a>
                </div>
            </div>
        </div>
    </section>

    <footer class="footer py-4">
        <div class="container text-center">
            Data z registru vozidel, poslední aktualizace: @Display(vozidlo?.LastUpdated)
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
