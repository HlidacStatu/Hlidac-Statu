@using HlidacStatu.Repositories
@using HlidacStatu.Web.TagHelpers
@using HlidacStatu.XLib.Render
@using Microsoft.AspNetCore.Mvc.TagHelpers
@model List<HlidacStatu.Repositories.SubsidyRepo.ProgramStatistics>

@{
    ViewBag.Title = "Program " + "XXXX";
    ViewBag.SubTitle = "Detail programu";
}

@section breadcrumb
{
    <ol class="breadcrumb">
        <li>
            <a href="/">Hlídač Státu</a>
        </li>
        <li>
            <a href="@Url.Action("Index", "Dotace")">Dotace</a>
        </li>
        <li class="active">@ViewBag.SubTitle</li>
    </ol>
}

@{
    var programPoLetech = new ReportDataSource<(int Year, decimal SumAssumedAmount, decimal MinAssumedAmount, decimal MaxAssumedAmount, decimal AvgAssumedAmount)>(
        new[]
        {
            new ReportDataSource<(int Year, decimal SumAssumedAmount, decimal MinAssumedAmount, decimal MaxAssumedAmount, decimal AvgAssumedAmount)>.Column()
            {
                Name = "Rok",
                TextRender = (x) => $"{x.Year}",
                HtmlRender = (x) => $"{x.Year}",
                OrderValueRender = (x) => HlidacStatu.Util.RenderData.OrderValueFormat(x.Year),
                CssClass = "number"
            },
            new ReportDataSource<(int Year, decimal SumAssumedAmount, decimal MinAssumedAmount, decimal MaxAssumedAmount, decimal AvgAssumedAmount)>.Column()
            {
                Name = "Vyplaceno",
                TextRender = (x) => HlidacStatu.Util.RenderData.NicePrice(x.SumAssumedAmount),
                HtmlRender = (x) => HlidacStatu.Util.RenderData.NicePrice(x.SumAssumedAmount),
                OrderValueRender = (x) => HlidacStatu.Util.RenderData.OrderValueFormat(x.SumAssumedAmount),
                CssClass = "number"
            },
            new ReportDataSource<(int Year, decimal SumAssumedAmount, decimal MinAssumedAmount, decimal MaxAssumedAmount, decimal AvgAssumedAmount)>.Column()
            {
                Name = "Průměrná dotace",
                TextRender = (x) => HlidacStatu.Util.RenderData.NicePrice(x.AvgAssumedAmount),
                HtmlRender = (x) => HlidacStatu.Util.RenderData.NicePrice(x.AvgAssumedAmount),
                OrderValueRender = (x) => HlidacStatu.Util.RenderData.OrderValueFormat(x.AvgAssumedAmount),
                CssClass = "number"
            }
        });

    var topPrijemciOrdered = Model.OrderByDescending(m => m.Year).ToList(); 
    
    programPoLetech.AddRows(topPrijemciOrdered.Select(x => (x.Year, x.SumAssumedAmount, x.MinAssumedAmount, x.MaxAssumedAmount, x.AvgAssumedAmount)));
}

<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.13.4/css/jquery.dataTables.css" />
<script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.js"></script>

<partial name="_SearchForm" model="@(new HlidacStatu.Repositories.Searching.SubsidySearchResult())" />

<h2>
    <add-bookmark item="@Model"></add-bookmark>
    Detail programu "XXXX"
</h2>


<div class="container py-4">
    <!-- Main Card -->
    <div class="card shadow-sm">

        <!-- Project Title Section -->
        <div class="card-body border-bottom bg-light">
            <h2 class="h5 text-muted mb-2">Název programu</h2>
            <p class="h4 mb-0">
                "XXXX"
            </p>
            <p class="mt-2">
                <b>Kód programu</b>: XXXXYYYY
            </p>
        </div>

        <!-- Financial Summary -->
        <div class="card-body border-bottom bg-white">
            <div class="row g-4">
                <div class="col-md-4">
                    <div class="card h-100 bg-success bg-opacity-10 border-success">
                        <div class="card-body">
                            <h3 class="h6 text-muted">Celkem vyplaceno</h3>
                            <p class="h4 mb-0">
                                @if (Model.Any())
                                {
                                    @HlidacStatu.Util.RenderData.NicePriceHtml(Model.Sum(x => x.SumAssumedAmount))
                                }
                                else
                                {
                                    <p>hodnota neznámá</p>
                                }
                            </p>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card h-100 bg-info bg-opacity-10 border-info">
                        <div class="card-body">
                            <h3 class="h6 text-muted">Počet dotovaných firem</h3>
                            <p class="h4 mb-0">
                                @if (Model.Any())
                                {
                                    @Model.Sum(x => x.RecipientIcoCount)
                                }
                                else
                                {
                                    <p>hodnota neznámá</p>
                                }
                            </p>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card h-100 bg-secondary bg-opacity-10 border-secondary">
                        <div class="card-body">
                            <h3 class="h6 text-muted">Doba trvání programu</h3>
                            <p class="text-muted mb-0">
                                @if (Model.Any())
                                {
                                    <span>@Model.Min(x => x.Year)</span><strong>-</strong><span>@Model.Max(x => x.Year)</span> 
                                }
                                else
                                {
                                    <p>hodnota neznámá</p>
                                }
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Details Grid -->
        <div class="card-body">
            <div class="row g-4">
                <div class="col-lg-6">
                    <h3 class="h5 mb-3">Informace o programu</h3>
                    <div>
                        @{
                            string dataTableOptions = @"{
                         'language': {
                            'url': '//cdn.datatables.net/plug-ins/1.13.4/i18n/cs.json'
                        },
                        'order': [[2, 'desc']],
                        'lengthChange': false,
                        'info': false,
                        }";
                        }

                        @Html.DataToHTMLTable(programPoLetech, tableId:"topPrijemciTab", dataTableOptions:dataTableOptions)
                    </div>
                </div>

                <div class="col-lg-6">
                    <h3 class="h5 mb-3">Grafy</h3>
                    
                </div>
            </div>
        </div>

        <!-- Footer with metadata -->
        <div class="card-footer bg-light">
            <div class="row text-muted small">
                <div class="col-md">
                    <p class="mb-1">Datum zpracování: @DateTime.Now.ToString("dd.MM.yyyy")</p>
                </div>
                <div class="col-md text-md-end">
                    <p class="mb-1">Zdroj dat: Různé zdroje</p>
                    <p class="mb-1">Datový soubor: Různé soubory</p>
                </div>
                <div class="col-md-12">
                    <p>sem se ještě něco vejde</p>
                </div>
            </div>
        </div>
    </div>
</div>



@section footerscripts {
    <script>
        $(function () {
            $('[data-bs-toggle="tooltip"]').tooltip()
        })
    </script>
}