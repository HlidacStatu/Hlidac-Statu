@using System.Threading
@using HlidacStatu.Connectors.External.ProfilZadavatelu
@using HlidacStatu.Repositories
@using HlidacStatu.Repositories.Cache
<div class="mega-content px-4">
    <div class="container-fluid">
        <div class="row">
            <div class="col-12 col-md-4 py-4  bg-body-tertiary">
                <h3>Statistiky smluv</h3>
                <ul class="list-group">
                    <li class="list-group-item d-flex justify-content-between align-items-start">
                        <div class="ms-2 me-auto">
                            <div class="fw-bold">Souhrny</div>
                            <a onclick="return trackOutLink(this,'megamenu');" href="/report/7">Souhrnné informace o
                                všech smlouvách</a>
                        </div>
                    </li>
                    <li class="list-group-item d-flex justify-content-between align-items-start">
                        <div class="ms-2 me-auto">
                            <div class="fw-bold">Stát</div>
                            <ul>
                                <li>
                                    <a onclick="return trackOutLink(this,'megamenu');" href="/adresar/Ministerstva">Ministerstva</a>
                                </li>
                                <li>
                                    <a onclick="return trackOutLink(this,'megamenu');" href="/adresar/Media">Média</a>

                                </li>
                                <li>
                                    <a onclick="return trackOutLink(this,'megamenu');" href="/adresar/Statni_podniky">Státní
                                        podniky</a>
                                </li>
                                <li>
                                    <a onclick="return trackOutLink(this,'megamenu');" href="/adresar/vyjimky_rs">Výjimky
                                        z RS</a>

                                </li>
                                <li><a onclick="return trackOutLink(this,'megamenu');" href="/adresar">... a další</a>
                                </li>
                            </ul>
                        </div>

                    </li>
                    <li class="list-group-item d-flex justify-content-between align-items-start">
                        <div class="ms-2 me-auto">
                            <div class="fw-bold">Samospráva</div>
                            <ul>
                                <li>
                                    <a onclick="return trackOutLink(this,'megamenu');" href="/adresar/Obce_III_stupne">Obce</a>

                                </li>
                                <li>
                                    <a onclick="return trackOutLink(this,'megamenu');"
                                       href="/adresar/Kraje_Praha">Kraje</a>


                                </li>
                                <li>
                                    <a onclick="return trackOutLink(this,'megamenu');" href="/adresar/Statutarni_mesta">Statutární
                                        města</a>

                                </li>
                                <li>
                                    <a onclick="return trackOutLink(this,'megamenu');"
                                       href="/adresar/Mestske_casti_Prahy">Městské části Prahy</a>

                                </li>
                                <li><a onclick="return trackOutLink(this,'megamenu');" href="/adresar">... a další</a>
                                </li>
                            </ul>
                        </div>

                    </li>

                </ul>
            </div>
            <div class="col-12 col-md-4 py-4">
                <h3>Registr smluv</h3>
                <h4>Speciální reporty</h4>
                <div class="mega-content-subtitle">Smlouvy uveřejněné konkrétní den</div>
                <div>
                    <link href="/scripts/zabuto_calendar.min.css" rel="stylesheet"/>
                    <script src="/scripts/zabuto_calendar.min.js"></script>
                    <style>
                        table.lightgrey-weekends tbody td:nth-child(n+6) {
                            background-color: #f3f3f3;
                        }

                        .zabuto-calendar.table.table-bordered > tbody > tr > td {
                            line-height: 0;
                            padding: 9px 9px;
                        }
                    </style>
                    <!-- define an element -->
                    <div id="megamenu_sml_cal" style=""></div>

                    <!-- initialize the plugin -->
                    <script>
                        $(document).ready(function () {
                            var $megamenu_sml_cal = $("#megamenu_sml_cal").zabuto_calendar({
                                classname: 'table table-bordered lightgrey-weekends clickable',
                                header_format: '[month] [year]',
                                week_starts: 'monday',
                                show_days: true,
                                language: 'cs',
                                navigation_next: true,
                                today_markup: '<span class="text-primary fw-bold">[day]</span>',

                            });
                            $megamenu_sml_cal.on('zabuto:calendar:day', function (e) {
                                var url = 'https://www.hlidacstatu.cz/HledatSmlouvy?Q=zverejneno:' + e.date.getFullYear() + '-' + (e.date.getMonth() + 1).toString().padStart(2, '0') + '-' + e.date.getDate().toString().padStart(2, '0');
                                console.log(url);
                                window.location = url;
                            });
                        });

                    </script>


                    <hr/>
                </div>
                <p><a onclick="return trackOutLink(this,'megamenu');" href="/Report/9">Firmy založené těsně před
                        uzavřením smlouvy</a></p>
                <p><a onclick="return trackOutLink(this,'megamenu');" href="/Report/5">Smlouvy s firmami, co přímo či
                        nepřímo sponzorují politické strany</a></p>
                <!-- <h5>Podle krajů</h5>
                <p class="text-center">
                    <img src="/content/img/Czech_Republic_location_map_nazvy.svg" style="width:90%;height:auto;" />
                </p>
                -->
            </div>
            <div class="col-12 col-md-4 py-4 bg-body-tertiary">
                @{
                    var vzs = await LocalHtmlExtensions.GetVzList();

                    var vzList = vzs
                        .Where(m => m.Count > 0)
                        .OrderByDescending(o => o.Count)
                        .ThenBy(o => o.Name)
                        .ToArray();
                    
                    long vzCount = 0;
                }
                <h3>Veřejné Zakázky</h3>
                <h4>Hlavní oblasti</h4>
                <ul class="list-group">
                    @foreach (var obl in vzList.Take(10))
                    {
                        vzCount = vzCount + obl.Count;

                        <li class="list-group-item">
                            <a onclick="return trackOutLink(this,'megamenu');"
                               href="/verejnezakazky/hledat?q=&oblast=@VerejnaZakazkaRepo.Searching.NormalizeOblastValue(obl.Id.ToString())&order=1">@obl.Name</a>
                        </li>
                    }
                    <li class="list-group-item">
                        <b><a onclick="return trackOutLink(this,'megamenu');" href="/verejnezakazky/">Všechny obory
                                veřejných zakázek</a></b>
                    </li>

                </ul>
            </div>
        </div>
    </div>
</div>
